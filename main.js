/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => SuikaUltility
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var DEFAULT_SETTINGS = {
  baseFolder: "Life",
  baseClassFolder: "Class"
};
var SuikaUltility = class extends import_obsidian.Plugin {
  async onload() {
    console.log("Loading SuikaUltility...");
    await this.loadSettings();
    this.addCommand({
      id: "new-daily-note",
      name: "New Daily Note",
      callback: async () => {
        await this.createDailyNote();
      }
    });
    this.addCommand({
      id: "new-class-note",
      name: "New Class Note",
      callback: async () => {
        await this.createClassNote();
      }
    });
    this.addSettingTab(new SuikaUltilitySettingTab(this.app, this));
    this.registerEvent(
      this.app.workspace.on("editor-paste", this.handlePaste.bind(this))
    );
  }
  onunload() {
    console.log("Unloading SuikaUltility...");
  }
  handlePaste(evt, editor, markdownView) {
    const clipboardData = evt.clipboardData;
    if (!clipboardData) {
      return;
    }
    const text = clipboardData.getData("text");
    const imgurRegex = /^https:\/\/i\.imgur\.com\/[a-zA-Z0-9]+\.png$/;
    const matches = text.match(imgurRegex);
    if (matches) {
      evt.preventDefault();
      const formattedText = matches.map((link) => `![](${link})`).join("\n");
      editor.replaceSelection(formattedText);
    }
  }
  async createDailyNote() {
    const today = new Date();
    const year = today.getFullYear();
    const month = String(today.getMonth() + 1).padStart(2, "0");
    const day = String(today.getDate()).padStart(2, "0");
    const noteTitle = `${day}-${month}-${year}`;
    const folderPath = (0, import_obsidian.normalizePath)(`${this.settings.baseFolder}/${year}/${month}`);
    const filePath = `${folderPath}/${noteTitle}.md`;
    const folderExists = await this.app.vault.adapter.exists(folderPath);
    if (!folderExists) {
      await this.app.vault.createFolder(folderPath);
    }
    const fileExists = await this.app.vault.adapter.exists(filePath);
    if (!fileExists) {
      const content = `# ${noteTitle}

`;
      await this.app.vault.create(filePath, content);
      new import_obsidian.Notice(`Daily note created: ${filePath}`);
    } else {
      new import_obsidian.Notice(`Daily note already exists: ${filePath}`);
    }
    const file = this.app.vault.getAbstractFileByPath(filePath);
    if (file instanceof import_obsidian.TFile) {
      this.app.workspace.getLeaf(true).openFile(file);
    }
  }
  async createClassNote() {
    const folder = await new FolderPickerModal(this.app, this.settings.baseClassFolder).openModal();
    if (!folder) {
      new import_obsidian.Notice("No folder selected. Operation canceled.");
      return;
    }
    const modal = new FilenameModal(this.app, async (filename) => {
      const today = new Date();
      const formattedDate = `${String(today.getDate()).padStart(2, "0")}-${String(today.getMonth() + 1).padStart(2, "0")}-${today.getFullYear()}`;
      const fullFilename = `${formattedDate} ${filename.trim()}.md`;
      const filePath = (0, import_obsidian.normalizePath)(`${folder}/${fullFilename}`);
      const fileExists = await this.app.vault.adapter.exists(filePath);
      if (!fileExists) {
        const content = `# ${filename.trim()}

`;
        await this.app.vault.create(filePath, content);
        new import_obsidian.Notice(`Class note created: ${filePath}`);
      } else {
        new import_obsidian.Notice(`Class note already exists: ${filePath}`);
      }
      const file = this.app.vault.getAbstractFileByPath(filePath);
      if (file instanceof import_obsidian.TFile) {
        this.app.workspace.getLeaf(true).openFile(file);
      }
    });
    modal.open();
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
var SuikaUltilitySettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "Settings for SuikaUltility" });
    new import_obsidian.Setting(containerEl).setName("Base Folder").setDesc("Base folder for daily notes").addText((text) => text.setPlaceholder("Enter base folder").setValue(this.plugin.settings.baseFolder).onChange(async (value) => {
      this.plugin.settings.baseFolder = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Base Class Folder").setDesc("Base folder for class notes").addText((text) => text.setPlaceholder("Enter base class folder").setValue(this.plugin.settings.baseClassFolder).onChange(async (value) => {
      this.plugin.settings.baseClassFolder = value;
      await this.plugin.saveSettings();
    }));
  }
};
var FolderPickerModal = class extends import_obsidian.FuzzySuggestModal {
  constructor(app, baseFolder) {
    super(app);
    this.baseFolder = baseFolder;
  }
  getItems() {
    const folderItems = this.app.vault.getAllLoadedFiles().filter((f) => f.path.startsWith(this.baseFolder) && !(f instanceof import_obsidian.TFile)).map((f) => f.path);
    return folderItems.length > 0 ? folderItems : [this.baseFolder];
  }
  getItemText(item) {
    return item;
  }
  onChooseItem(item) {
    this.resolve(item);
  }
  openModal() {
    return new Promise((resolve) => {
      this.resolve = resolve;
      this.open();
    });
  }
};
var FilenameModal = class extends import_obsidian.Modal {
  constructor(app, onSubmit) {
    super(app);
    this.onSubmit = onSubmit;
  }
  onOpen() {
    const { contentEl } = this;
    contentEl.createEl("h2", { text: "Enter Filename" });
    const input = contentEl.createEl("input", { type: "text" });
    input.style.width = "100%";
    input.placeholder = "Enter the filename here...";
    const submitButton = contentEl.createEl("button", { text: "Submit" });
    submitButton.style.marginTop = "10px";
    submitButton.style.width = "100%";
    submitButton.addEventListener("click", () => {
      const filename = input.value.trim();
      if (filename) {
        this.onSubmit(filename);
        this.close();
      } else {
        new import_obsidian.Notice("Filename cannot be empty!");
      }
    });
    input.addEventListener("keypress", (event) => {
      if (event.key === "Enter") {
        submitButton.click();
      }
    });
  }
  onClose() {
    const { contentEl } = this;
    contentEl.empty();
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgXG4gIEFwcCwgXG4gIE5vdGljZSwgXG4gIFBsdWdpbiwgXG4gIFRGaWxlLCBcbiAgbm9ybWFsaXplUGF0aCwgXG4gIFBsdWdpblNldHRpbmdUYWIsIFxuICBTZXR0aW5nLCBcbiAgTWFya2Rvd25WaWV3LCBcbiAgTW9kYWwsIFxuICBGdXp6eVN1Z2dlc3RNb2RhbCBcbn0gZnJvbSAnb2JzaWRpYW4nO1xuXG5pbnRlcmZhY2UgU3Vpa2FVbHRpbGl0eVNldHRpbmdzIHtcbiAgYmFzZUZvbGRlcjogc3RyaW5nO1xuICBiYXNlQ2xhc3NGb2xkZXI6IHN0cmluZztcbn1cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUzogU3Vpa2FVbHRpbGl0eVNldHRpbmdzID0ge1xuICBiYXNlRm9sZGVyOiAnTGlmZScsXG4gIGJhc2VDbGFzc0ZvbGRlcjogJ0NsYXNzJ1xufTtcblxuXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFN1aWthVWx0aWxpdHkgZXh0ZW5kcyBQbHVnaW4ge1xuICBzZXR0aW5nczogU3Vpa2FVbHRpbGl0eVNldHRpbmdzO1xuXG4gIGFzeW5jIG9ubG9hZCgpIHtcbiAgICBjb25zb2xlLmxvZygnTG9hZGluZyBTdWlrYVVsdGlsaXR5Li4uJyk7XG5cbiAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuXG4gICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiAnbmV3LWRhaWx5LW5vdGUnLFxuICAgICAgbmFtZTogJ05ldyBEYWlseSBOb3RlJyxcbiAgICAgIGNhbGxiYWNrOiBhc3luYyAoKSA9PiB7XG4gICAgICAgIGF3YWl0IHRoaXMuY3JlYXRlRGFpbHlOb3RlKCk7XG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgdGhpcy5hZGRDb21tYW5kKHtcbiAgICAgIGlkOiAnbmV3LWNsYXNzLW5vdGUnLFxuICAgICAgbmFtZTogJ05ldyBDbGFzcyBOb3RlJyxcbiAgICAgIGNhbGxiYWNrOiBhc3luYyAoKSA9PiB7XG4gICAgICAgIGF3YWl0IHRoaXMuY3JlYXRlQ2xhc3NOb3RlKCk7XG4gICAgICB9LFxuICAgIH0pO1xuXG5cbiAgICB0aGlzLmFkZFNldHRpbmdUYWIobmV3IFN1aWthVWx0aWxpdHlTZXR0aW5nVGFiKHRoaXMuYXBwLCB0aGlzKSk7XG5cbiAgICB0aGlzLnJlZ2lzdGVyRXZlbnQoXG4gICAgICB0aGlzLmFwcC53b3Jrc3BhY2Uub24oJ2VkaXRvci1wYXN0ZScsIHRoaXMuaGFuZGxlUGFzdGUuYmluZCh0aGlzKSlcbiAgICApO1xuICB9XG5cbiAgb251bmxvYWQoKSB7XG4gICAgY29uc29sZS5sb2coJ1VubG9hZGluZyBTdWlrYVVsdGlsaXR5Li4uJyk7XG4gIH1cblxuICBoYW5kbGVQYXN0ZShldnQ6IENsaXBib2FyZEV2ZW50LCBlZGl0b3I6IENvZGVNaXJyb3IuRWRpdG9yLCBtYXJrZG93blZpZXc6IE1hcmtkb3duVmlldykge1xuICAgIGNvbnN0IGNsaXBib2FyZERhdGEgPSBldnQuY2xpcGJvYXJkRGF0YTtcbiAgICBpZiAoIWNsaXBib2FyZERhdGEpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB0ZXh0ID0gY2xpcGJvYXJkRGF0YS5nZXREYXRhKCd0ZXh0Jyk7XG4gICAgY29uc3QgaW1ndXJSZWdleCA9IC9eaHR0cHM6XFwvXFwvaVxcLmltZ3VyXFwuY29tXFwvW2EtekEtWjAtOV0rXFwucG5nJC87XG4gICAgY29uc3QgbWF0Y2hlcyA9IHRleHQubWF0Y2goaW1ndXJSZWdleCk7XG4gICAgaWYgKG1hdGNoZXMpIHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY29uc3QgZm9ybWF0dGVkVGV4dCA9IG1hdGNoZXMubWFwKGxpbmsgPT4gYCFbXSgke2xpbmt9KWApLmpvaW4oJ1xcbicpO1xuICAgICAgZWRpdG9yLnJlcGxhY2VTZWxlY3Rpb24oZm9ybWF0dGVkVGV4dCk7XG4gICAgfVxuXG4gIH1cblxuXG4gIGFzeW5jIGNyZWF0ZURhaWx5Tm90ZSgpIHtcbiAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgeWVhciA9IHRvZGF5LmdldEZ1bGxZZWFyKCk7XG4gICAgY29uc3QgbW9udGggPSBTdHJpbmcodG9kYXkuZ2V0TW9udGgoKSArIDEpLnBhZFN0YXJ0KDIsJzAnKTtcbiAgICBjb25zdCBkYXkgPSBTdHJpbmcodG9kYXkuZ2V0RGF0ZSgpKS5wYWRTdGFydCgyLCAnMCcpO1xuICAgIGNvbnN0IG5vdGVUaXRsZSA9IGAke2RheX0tJHttb250aH0tJHt5ZWFyfWA7XG4gICAgY29uc3QgZm9sZGVyUGF0aCA9IG5vcm1hbGl6ZVBhdGgoYCR7dGhpcy5zZXR0aW5ncy5iYXNlRm9sZGVyfS8ke3llYXJ9LyR7bW9udGh9YCk7XG4gICAgY29uc3QgZmlsZVBhdGggPSBgJHtmb2xkZXJQYXRofS8ke25vdGVUaXRsZX0ubWRgO1xuXG5cbiAgICBjb25zdCBmb2xkZXJFeGlzdHMgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5hZGFwdGVyLmV4aXN0cyhmb2xkZXJQYXRoKTtcbiAgICBpZiAoIWZvbGRlckV4aXN0cykge1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlRm9sZGVyKGZvbGRlclBhdGgpO1xuICAgIH1cblxuXG4gICAgY29uc3QgZmlsZUV4aXN0cyA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LmFkYXB0ZXIuZXhpc3RzKGZpbGVQYXRoKTtcbiAgICBpZiAoIWZpbGVFeGlzdHMpIHtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBgIyAke25vdGVUaXRsZX1cXG5cXG5gO1xuICAgICAgYXdhaXQgdGhpcy5hcHAudmF1bHQuY3JlYXRlKGZpbGVQYXRoLCBjb250ZW50KTtcbiAgICAgIG5ldyBOb3RpY2UoYERhaWx5IG5vdGUgY3JlYXRlZDogJHtmaWxlUGF0aH1gKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbmV3IE5vdGljZShgRGFpbHkgbm90ZSBhbHJlYWR5IGV4aXN0czogJHtmaWxlUGF0aH1gKTtcbiAgICB9XG5cblxuICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpO1xuICAgIGlmIChmaWxlIGluc3RhbmNlb2YgVEZpbGUpIHtcbiAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5nZXRMZWFmKHRydWUpLm9wZW5GaWxlKGZpbGUpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZUNsYXNzTm90ZSgpIHtcbiAgICBjb25zdCBmb2xkZXIgPSBhd2FpdCBuZXcgRm9sZGVyUGlja2VyTW9kYWwodGhpcy5hcHAsIHRoaXMuc2V0dGluZ3MuYmFzZUNsYXNzRm9sZGVyKS5vcGVuTW9kYWwoKTtcbiAgICBpZiAoIWZvbGRlcikge1xuICAgICAgbmV3IE5vdGljZShcIk5vIGZvbGRlciBzZWxlY3RlZC4gT3BlcmF0aW9uIGNhbmNlbGVkLlwiKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIFxuICAgIGNvbnN0IG1vZGFsID0gbmV3IEZpbGVuYW1lTW9kYWwodGhpcy5hcHAsIGFzeW5jIChmaWxlbmFtZSkgPT4ge1xuICAgICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpO1xuICAgICAgY29uc3QgZm9ybWF0dGVkRGF0ZSA9IGAke1N0cmluZyh0b2RheS5nZXREYXRlKCkpLnBhZFN0YXJ0KDIsICcwJyl9LSR7U3RyaW5nKHRvZGF5LmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAnMCcpfS0ke3RvZGF5LmdldEZ1bGxZZWFyKCl9YDtcbiAgICAgIGNvbnN0IGZ1bGxGaWxlbmFtZSA9IGAke2Zvcm1hdHRlZERhdGV9ICR7ZmlsZW5hbWUudHJpbSgpfS5tZGA7XG4gICAgICBjb25zdCBmaWxlUGF0aCA9IG5vcm1hbGl6ZVBhdGgoYCR7Zm9sZGVyfS8ke2Z1bGxGaWxlbmFtZX1gKTtcbiAgXG4gICAgICBjb25zdCBmaWxlRXhpc3RzID0gYXdhaXQgdGhpcy5hcHAudmF1bHQuYWRhcHRlci5leGlzdHMoZmlsZVBhdGgpO1xuICAgICAgaWYgKCFmaWxlRXhpc3RzKSB7XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBgIyAke2ZpbGVuYW1lLnRyaW0oKX1cXG5cXG5gO1xuICAgICAgICBhd2FpdCB0aGlzLmFwcC52YXVsdC5jcmVhdGUoZmlsZVBhdGgsIGNvbnRlbnQpO1xuICAgICAgICBuZXcgTm90aWNlKGBDbGFzcyBub3RlIGNyZWF0ZWQ6ICR7ZmlsZVBhdGh9YCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXcgTm90aWNlKGBDbGFzcyBub3RlIGFscmVhZHkgZXhpc3RzOiAke2ZpbGVQYXRofWApO1xuICAgICAgfVxuICBcbiAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoZmlsZVBhdGgpO1xuICAgICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkge1xuICAgICAgICB0aGlzLmFwcC53b3Jrc3BhY2UuZ2V0TGVhZih0cnVlKS5vcGVuRmlsZShmaWxlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBtb2RhbC5vcGVuKCk7XG4gIH1cbiAgXG5cbiAgYXN5bmMgbG9hZFNldHRpbmdzKCkge1xuICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xuICB9XG5cbiAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xuICAgIGF3YWl0IHRoaXMuc2F2ZURhdGEodGhpcy5zZXR0aW5ncyk7XG4gIH1cbn1cblxuY2xhc3MgU3Vpa2FVbHRpbGl0eVNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcbiAgcGx1Z2luOiBTdWlrYVVsdGlsaXR5O1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBwbHVnaW46IFN1aWthVWx0aWxpdHkpIHtcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICBkaXNwbGF5KCk6IHZvaWQge1xuICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG5cbiAgICBjb250YWluZXJFbC5lbXB0eSgpO1xuXG4gICAgY29udGFpbmVyRWwuY3JlYXRlRWwoJ2gyJywgeyB0ZXh0OiAnU2V0dGluZ3MgZm9yIFN1aWthVWx0aWxpdHknIH0pO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZSgnQmFzZSBGb2xkZXInKVxuICAgICAgLnNldERlc2MoJ0Jhc2UgZm9sZGVyIGZvciBkYWlseSBub3RlcycpXG4gICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdFbnRlciBiYXNlIGZvbGRlcicpXG4gICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5iYXNlRm9sZGVyKVxuICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuYmFzZUZvbGRlciA9IHZhbHVlO1xuICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICB9KSk7XG4gICAgXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZSgnQmFzZSBDbGFzcyBGb2xkZXInKVxuICAgICAgLnNldERlc2MoJ0Jhc2UgZm9sZGVyIGZvciBjbGFzcyBub3RlcycpXG4gICAgICAuYWRkVGV4dCh0ZXh0ID0+IHRleHRcbiAgICAgICAgLnNldFBsYWNlaG9sZGVyKCdFbnRlciBiYXNlIGNsYXNzIGZvbGRlcicpXG4gICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5iYXNlQ2xhc3NGb2xkZXIpXG4gICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5iYXNlQ2xhc3NGb2xkZXIgPSB2YWx1ZTtcbiAgICAgICAgICBhd2FpdCB0aGlzLnBsdWdpbi5zYXZlU2V0dGluZ3MoKTtcbiAgICAgICAgfSkpO1xuICB9XG59XG5cbmNsYXNzIEZvbGRlclBpY2tlck1vZGFsIGV4dGVuZHMgRnV6enlTdWdnZXN0TW9kYWw8c3RyaW5nPiB7XG4gIGJhc2VGb2xkZXI6IHN0cmluZztcbiAgcmVzb2x2ZTogKHZhbHVlOiBzdHJpbmcgfCBQcm9taXNlTGlrZTxzdHJpbmc+KSA9PiB2b2lkO1xuXG4gIGNvbnN0cnVjdG9yKGFwcDogQXBwLCBiYXNlRm9sZGVyOiBzdHJpbmcpIHtcbiAgICBzdXBlcihhcHApO1xuICAgIHRoaXMuYmFzZUZvbGRlciA9IGJhc2VGb2xkZXI7XG4gIH1cblxuICBnZXRJdGVtcygpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgZm9sZGVySXRlbXMgPSB0aGlzLmFwcC52YXVsdC5nZXRBbGxMb2FkZWRGaWxlcygpXG4gICAgICAuZmlsdGVyKGYgPT4gZi5wYXRoLnN0YXJ0c1dpdGgodGhpcy5iYXNlRm9sZGVyKSAmJiAhKGYgaW5zdGFuY2VvZiBURmlsZSkpXG4gICAgICAubWFwKGYgPT4gZi5wYXRoKTtcbiAgICByZXR1cm4gZm9sZGVySXRlbXMubGVuZ3RoID4gMCA/IGZvbGRlckl0ZW1zIDogW3RoaXMuYmFzZUZvbGRlcl07XG4gIH1cblxuICBnZXRJdGVtVGV4dChpdGVtOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIHJldHVybiBpdGVtO1xuICB9XG5cbiAgb25DaG9vc2VJdGVtKGl0ZW06IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMucmVzb2x2ZShpdGVtKTtcbiAgfVxuXG4gIG9wZW5Nb2RhbCgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgIHRoaXMucmVzb2x2ZSA9IHJlc29sdmU7XG4gICAgICB0aGlzLm9wZW4oKTtcbiAgICB9KTtcbiAgfVxufVxuXG5jbGFzcyBGaWxlbmFtZU1vZGFsIGV4dGVuZHMgTW9kYWwge1xuICBvblN1Ym1pdDogKGZpbGVuYW1lOiBzdHJpbmcpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIG9uU3VibWl0OiAoZmlsZW5hbWU6IHN0cmluZykgPT4gdm9pZCkge1xuICAgIHN1cGVyKGFwcCk7XG4gICAgdGhpcy5vblN1Ym1pdCA9IG9uU3VibWl0O1xuICB9XG5cbiAgb25PcGVuKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5jcmVhdGVFbCgnaDInLCB7IHRleHQ6ICdFbnRlciBGaWxlbmFtZScgfSk7XG5cbiAgICBjb25zdCBpbnB1dCA9IGNvbnRlbnRFbC5jcmVhdGVFbCgnaW5wdXQnLCB7IHR5cGU6ICd0ZXh0JyB9KTtcbiAgICBpbnB1dC5zdHlsZS53aWR0aCA9ICcxMDAlJztcbiAgICBpbnB1dC5wbGFjZWhvbGRlciA9ICdFbnRlciB0aGUgZmlsZW5hbWUgaGVyZS4uLic7XG5cbiAgICBjb25zdCBzdWJtaXRCdXR0b24gPSBjb250ZW50RWwuY3JlYXRlRWwoJ2J1dHRvbicsIHsgdGV4dDogJ1N1Ym1pdCcgfSk7XG4gICAgc3VibWl0QnV0dG9uLnN0eWxlLm1hcmdpblRvcCA9ICcxMHB4JztcbiAgICBzdWJtaXRCdXR0b24uc3R5bGUud2lkdGggPSAnMTAwJSc7XG5cbiAgICBzdWJtaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICBjb25zdCBmaWxlbmFtZSA9IGlucHV0LnZhbHVlLnRyaW0oKTtcbiAgICAgIGlmIChmaWxlbmFtZSkge1xuICAgICAgICB0aGlzLm9uU3VibWl0KGZpbGVuYW1lKTtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3IE5vdGljZSgnRmlsZW5hbWUgY2Fubm90IGJlIGVtcHR5IScpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcigna2V5cHJlc3MnLCAoZXZlbnQpID0+IHtcbiAgICAgIGlmIChldmVudC5rZXkgPT09ICdFbnRlcicpIHtcbiAgICAgICAgc3VibWl0QnV0dG9uLmNsaWNrKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBvbkNsb3NlKCkge1xuICAgIGNvbnN0IHsgY29udGVudEVsIH0gPSB0aGlzO1xuICAgIGNvbnRlbnRFbC5lbXB0eSgpO1xuICB9XG59XG5cblxuXG4vLzMuMi40IFx1NEVFM1x1NzgwMVx1ODlFM1x1Njc5MFxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLHNCQVdPO0FBT1AsSUFBTSxtQkFBMEM7QUFBQSxFQUM5QyxZQUFZO0FBQUEsRUFDWixpQkFBaUI7QUFDbkI7QUFJQSxJQUFxQixnQkFBckIsY0FBMkMsdUJBQU87QUFBQSxFQUdoRCxNQUFNLFNBQVM7QUFDYixZQUFRLElBQUksMEJBQTBCO0FBRXRDLFVBQU0sS0FBSyxhQUFhO0FBRXhCLFNBQUssV0FBVztBQUFBLE1BQ2QsSUFBSTtBQUFBLE1BQ0osTUFBTTtBQUFBLE1BQ04sVUFBVSxZQUFZO0FBQ3BCLGNBQU0sS0FBSyxnQkFBZ0I7QUFBQSxNQUM3QjtBQUFBLElBQ0YsQ0FBQztBQUVELFNBQUssV0FBVztBQUFBLE1BQ2QsSUFBSTtBQUFBLE1BQ0osTUFBTTtBQUFBLE1BQ04sVUFBVSxZQUFZO0FBQ3BCLGNBQU0sS0FBSyxnQkFBZ0I7QUFBQSxNQUM3QjtBQUFBLElBQ0YsQ0FBQztBQUdELFNBQUssY0FBYyxJQUFJLHdCQUF3QixLQUFLLEtBQUssSUFBSSxDQUFDO0FBRTlELFNBQUs7QUFBQSxNQUNILEtBQUssSUFBSSxVQUFVLEdBQUcsZ0JBQWdCLEtBQUssWUFBWSxLQUFLLElBQUksQ0FBQztBQUFBLElBQ25FO0FBQUEsRUFDRjtBQUFBLEVBRUEsV0FBVztBQUNULFlBQVEsSUFBSSw0QkFBNEI7QUFBQSxFQUMxQztBQUFBLEVBRUEsWUFBWSxLQUFxQixRQUEyQixjQUE0QjtBQUN0RixVQUFNLGdCQUFnQixJ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
